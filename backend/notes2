potentiel structure du dossier :

transcendence/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ tournoi/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ index.js
â”‚   â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ models/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ match/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ index.js
â”‚   â””â”€â”€ ...
â”œâ”€â”€ game/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ score/
â”‚   â””â”€â”€ ...

ne pas lire....
# APP_PASS="fqwr odcx igae hjfv"
# USR_ADDR="nathantrijaud@gmail.com"

RÃ´le de chaque service et modÃ¨le dans ta stack

1. Le service 01_user (User-service)
But : GÃ©rer les utilisateurs "authentification / donnÃ©es utilisateurs".

Base de donnÃ©es : users_db â€” contient la table users (id, name, status, etc).

ModÃ¨les dans models/*.js :

Gestion des utilisateurs dans la table users (ex: models/players.js dans user-service est en fait le modÃ¨le User).

Le service expose une API HTTP (ex: /api/users/:name) qui renvoie les donnÃ©es utilisateur.

Fonction dans lâ€™architecture :
Câ€™est la source de vÃ©ritÃ© des utilisateurs. Tout ce qui concerne la validation, la crÃ©ation, le statut des users passe par ce service.

2. Le service 02_tournament (Tournament-service)
But : GÃ©rer les tournois, pools, joueurs dans un contexte tournoi.

Base de donnÃ©es : tournaments.db â€” contient tables pools, pool_players, et aussi players (liste des joueurs impliquÃ©s dans les tournois).

ModÃ¨les dans models/*.js :

Gestion des pools, joueurs dans le tournoi (classe Pool, table players locale).

Mais les joueurs sont crÃ©Ã©s via une requÃªte HTTP vers le service 01_user pour rÃ©cupÃ©rer les infos utilisateurs.

La table players locale sert Ã  stocker une copie des joueurs (avec id, nom, statut) prÃ©sents dans le contexte tournoi, pour les manipuler et les relier aux pools.




-------------------------------------------

multi-service-project/
â”‚
â”œâ”€â”€ docker-compose.yml
â”‚
â”œâ”€â”€ 01_user/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ index.js            # Point d'entrÃ©e Fastify
â”‚   â”œâ”€â”€ /routes             # Routes REST de l'API
â”‚   â”œâ”€â”€ /controllers        # Logique mÃ©tier
â”‚   â”œâ”€â”€ /models             # SchÃ©ma des donnÃ©es
â”‚   â””â”€â”€ /db                 # Initialisation et accÃ¨s Ã  SQLite
â”‚
â”œâ”€â”€ 02_tournament/
â”‚   â”œâ”€â”€ ... (idem user)
â”‚
â”œâ”€â”€ 03_match/
â”‚   â”œâ”€â”€ ... (idem user)


---
ðŸ§© Architecture REST

Chaque service possÃ¨de :

Son propre serveur Fastify

Sa base SQLite

Une API REST pour Ãªtre appelÃ© par d'autres services ou par un frontend

Communication inter-services via HTTP REST avec les noms des services Docker :

http://match-service:3002/matches
http://user-service:3000/users

----

ðŸ“Š Bases de donnÃ©es (SQLite)
Service	Base SQLite	Tables principales
01_user	user.db	users
02_tournament	tournament.db	tournaments, pools
03_match	match.db	matches

Les bases sont crÃ©Ã©es au dÃ©marrage via des scripts dans /db/init.js ou /models/init.js.

ðŸ” Exemple de flux REST
CrÃ©er un match manuellement :

	POST /matches
	Content-Type: application/json

	{
	"player1": 1,
	"player2": 2,
	"mode": "duel"
	}

ðŸ“‚ Exemple de modÃ¨le Fastify (models/tournaments.js)
CrÃ©er un tournoi qui appelle le match-service :

	// tournament-service
	await fetch('http://match-service:3002/matches', {
	method: 'POST',
	headers: { 'Content-Type': 'application/json' },
	body: JSON.stringify({
		player1: 5,
		player2: 8,
		mode: 'pool'
	})
	});


-------------------------------------

29 juillet : 

A faire:

_ base image en local.






TO DO

- Retaper les DBs (ouverture, globale forbidden ! try catch)
- Penser a fermer les DBs a la fin du programme !

- 401 -> refresh / 403 -> relog

- En l'etat actuel, on peut envoyer plusieurs requetes a /session/refresh
	pour generer plusieurs accessTokens....


- Proteger la route /user/changeStatus -> cles API
- /match : historique des matches pour un player
- /user : empecher les registered de s'appeler "Guest(...)"
- /user & /match : login par email OU par name
- verifier l'existence des ENV 
- liste d'amis: si un ami delete son compte, mettre a jour la liste d'amis ?


- service stats ? db : wins, losses, win streak, ... ?

DONE /match -> /endOfMatch : contient update match, update status, et met le match dans la table history
DONE remplacer winner_id par winner : "3:registered"
DONE /!\ Refaire les JWT !! Access token / Refresh token
DONE /user : renvoyer l'email dans la reponse
DONE login logout avec refreshtokens !!
DONE /session : cron pour erase revoked_access ?
DONE /user : get friends list
DONE mettre toutes les fonctions fetch dans un fichier a part
DONE /user : en arriere plan: supprimer les pending trop anciens
DONE /session : verifier en arriere plan dans active_tokens les JWT expires -> requete a /user/changeStatus
DONE /session : envoyer une requete a /user/changeStatus apres la revocation du token

NATHAN DONE Securiser les schemas: echapper les caracteres speciaux (attaques XSS)
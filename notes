potentiel structure du dossier :

transcendence/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ tournoi/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ index.js
â”‚   â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ models/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ match/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ index.js
â”‚   â””â”€â”€ ...
â”œâ”€â”€ game/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ score/
â”‚   â””â”€â”€ ...

ne pas lire....
fqwr odcx igae hjfv

RÃ´le de chaque service et modÃ¨le dans ta stack

1. Le service 01_user (User-service)
But : GÃ©rer les utilisateurs "authentification / donnÃ©es utilisateurs".

Base de donnÃ©es : users_db â€” contient la table users (id, name, status, etc).

ModÃ¨les dans models/*.js :

Gestion des utilisateurs dans la table users (ex: models/players.js dans user-service est en fait le modÃ¨le User).

Le service expose une API HTTP (ex: /api/users/:name) qui renvoie les donnÃ©es utilisateur.

Fonction dans lâ€™architecture :
Câ€™est la source de vÃ©ritÃ© des utilisateurs. Tout ce qui concerne la validation, la crÃ©ation, le statut des users passe par ce service.

2. Le service 02_tournament (Tournament-service)
But : GÃ©rer les tournois, pools, joueurs dans un contexte tournoi.

Base de donnÃ©es : tournaments.db â€” contient tables pools, pool_players, et aussi players (liste des joueurs impliquÃ©s dans les tournois).

ModÃ¨les dans models/*.js :

Gestion des pools, joueurs dans le tournoi (classe Pool, table players locale).

Mais les joueurs sont crÃ©Ã©s via une requÃªte HTTP vers le service 01_user pour rÃ©cupÃ©rer les infos utilisateurs.

La table players locale sert Ã  stocker une copie des joueurs (avec id, nom, statut) prÃ©sents dans le contexte tournoi, pour les manipuler et les relier aux pools.




-------------------------------------------

multi-service-project/
â”‚
â”œâ”€â”€ docker-compose.yml
â”‚
â”œâ”€â”€ 01_user/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ index.js            # Point d'entrÃ©e Fastify
â”‚   â”œâ”€â”€ /routes             # Routes REST de l'API
â”‚   â”œâ”€â”€ /controllers        # Logique mÃ©tier
â”‚   â”œâ”€â”€ /models             # SchÃ©ma des donnÃ©es
â”‚   â””â”€â”€ /db                 # Initialisation et accÃ¨s Ã  SQLite
â”‚
â”œâ”€â”€ 02_tournament/
â”‚   â”œâ”€â”€ ... (idem user)
â”‚
â”œâ”€â”€ 03_match/
â”‚   â”œâ”€â”€ ... (idem user)


---
ðŸ§© Architecture REST

Chaque service possÃ¨de :

Son propre serveur Fastify

Sa base SQLite

Une API REST pour Ãªtre appelÃ© par d'autres services ou par un frontend

Communication inter-services via HTTP REST avec les noms des services Docker :

http://match-service:3002/matches
http://user-service:3000/users

----

ðŸ“Š Bases de donnÃ©es (SQLite)
Service	Base SQLite	Tables principales
01_user	user.db	users
02_tournament	tournament.db	tournaments, pools
03_match	match.db	matches

Les bases sont crÃ©Ã©es au dÃ©marrage via des scripts dans /db/init.js ou /models/init.js.

ðŸ” Exemple de flux REST
CrÃ©er un match manuellement :

	POST /matches
	Content-Type: application/json

	{
	"player1": 1,
	"player2": 2,
	"mode": "duel"
	}

ðŸ“‚ Exemple de modÃ¨le Fastify (models/tournaments.js)
CrÃ©er un tournoi qui appelle le match-service :

	// tournament-service
	await fetch('http://match-service:3002/matches', {
	method: 'POST',
	headers: { 'Content-Type': 'application/json' },
	body: JSON.stringify({
		player1: 5,
		player2: 8,
		mode: 'pool'
	})
	});


-------------------------------------

29 juillet : 

A faire:

_ base image en local.






TO DO

- Proteger la route /user/changeStatus
- /session : envoyer une requete a /user/changeStatus apres la revocation du token
- /session : verifier en arriere plan dans active_tokens les JWT expires -> requete a /user/changeStatus
- /match : historique des matches pour un player
- /user : empecher les registered de s'appeler "Guest(...)"
- /user : get friends list
- /user & /match : login par email OU par name
- Fermer la DB a la fin du programme !
- /user : en arriere plan: supprimer les pending trop anciens
- verifier l'existence des ENV 
- Securiser les schemas: echapper les caracteres speciaux (attaques XSS)



NEW TODO

-	Lorsque l'user qui lance un tournoi quitte le tournois ---> Tournois close AND Logout all users
-	Accec token a tester (Refresh token a mettre a jour dans les cas ou expire)

- Bug: si pas d'access token, en tant que register on clique sur profil: le profil s'affiche
	briÃ¨vement et on revient sur la page d'accueil. Logout -> erreur lors de la
	dÃ©connexion.

DONE	Si pas accetoken dans requete faire reply 401
DONE	Si pas de refreshToken dans /session/refresh, renvoyer 403
DONE	Mot de passe incorect (code d'erreur specifique) ->> 444












user-service        | {"level":50,"time":1762253647060,"pid":1,"hostname":"feb276c2f511","reqId":"req-7","req":{"method":"PUT","url":"/updatestats","hostname":"user-service:3000","remoteAddress":"172.18.0.7","remotePort":58756},"res":{"statusCode":500},"err":{"type":"TypeError","message":"Cannot destructure property 'played_matches' of '(intermediate value)' as it is undefined.","stack":"TypeError: Cannot destructure property 'played_matches' of '(intermediate value)' as it is undefined.\n    at Object.updateStatsW (file:///usr/src/app/database/db.js:168:10)\n    at async Object.updateStats (file:///usr/src/app/controllers/controllers.js:497:13)"},"msg":"Cannot destructure property 'played_matches' of '(intermediate value)' as it is undefined."}
user-service        | {"level":30,"time":1762253647060,"pid":1,"hostname":"feb276c2f511","reqId":"req-7","res":{"statusCode":500},"responseTime":0.8324129581451416,"msg":"request completed"}
match-service       | {"level":50,"time":1762253647061,"pid":1,"hostname":"4c6774bad544","reqId":"req-5","req":{"method":"PUT","url":"/finish","hostname":"match-service:3000","remoteAddress":"172.18.0.4","remotePort":35756},"res":{"statusCode":500},"err":{"type":"TypeError","message":"Cannot read properties of undefined (reading 'name')","stack":"TypeError: Cannot read properties of undefined (reading 'name')\n    at fetchChangeStatus (file:///usr/src/app/controllers/fetchFunctions.js:6:22)\n    at Object.finish (file:///usr/src/app/controllers/controllers.js:130:16)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)"},"msg":"Cannot read properties of undefined (reading 'name')"}
